file = ARGV[0]
state = :start

current_word = ""

File(file).open.each do |line|
  case state
  when :start then
    current_word = line.strip
    state = :root
  when :root then
    if line == "Incoming:" then
      state = :incoming
    else
      raise "Unexpected: #{line}"
    end
  when :incoming then
    if line == "Outgoing:" then
      state = :outgoing
    elsif line[0..0] == "\t"
      print line, " ", current_word, "\n"
    else
      raise "Unexpected: #{line}"
    end
  when :outgoing then
    if line[0..0] == "\t"
      #just skip it
      ""
    else
      current_word = line.strip
      state = :root
    end
  end
end
  