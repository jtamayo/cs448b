<!DOCTYPE HTML>
<html>
  <head>
    <title>Matrix Diagram</title>
    <link type="text/css" rel="stylesheet" href="ex.css?3.2"/>
    <script type="text/javascript" src="../protovis-d3.2.js"></script>
    <script type="text/javascript" src="wantme.js"></script>
    <style type="text/css">

#fig {
  width: 960px;
  height: 720px;
}

    </style>
  </head>
  <body><div id="center"><div id="fig">
    <script type="text/javascript">
/*
 * There's five parts in the visualization:
 * - Rightmost panel for the origin
 * - Middle panel for the center word
 * - Right panel for the dest word
 * 
 * There's also two panels in the middle that contain the edges between the words.
 * 
 * I'll use 960 pixels width, 720 height???
 * That should be good enough for the iPad.
 * 
 */
// Setup - some useful methods for arrays
// Stolen from "Javascript, the good parts"
Function.prototype.method = function (name, func) {
    this.prototype[name] = func;
    return this;
};
Array.method('reduce', function (f, value) {
    var i;
    for (i = 0; i < this.length; i += 1) {
        value = f(this[i], value);
    }
    return value;
});


var font = "Helvetica, Arial, sans-serif"
var color = pv.Colors.category19().by(function(d) { return d.group });
var column = 60; // Width of a single column
var word = "shy"
var wordHeight = 15
var runSum = []
var i;
var sum = 0;

var incoming = [
{node: "old", count: 1},
{node: "secur", count: 1},
{node: "white", count: 2},
{node: "superfici", count: 1},
{node: "beauti", count: 1},
{node: "introvert", count: 1},
{node: "quiet", count: 1},
{node: "materialist", count: 1},]
var outgoing = [
{node: "brave", count: 1},
{node: "romant", count: 1},
{node: "singl", count: 2},
{node: "least", count: 1},
{node: "seriou", count: 1},
{node: "next", count: 1},
{node: "substanti", count: 1},
{node: "higher", count: 1},
{node: "intellig", count: 3},
{node: "good", count: 3},
{node: "same", count: 1},
{node: "honest", count: 3},
{node: "independ", count: 1},
{node: "slim", count: 2},
{node: "more", count: 1},
{node: "southern", count: 1},
{node: "easi", count: 1},
{node: "funni", count: 1},
{node: "casual", count: 1},
{node: "practic", count: 1},
{node: "care", count: 1},
{node: "mind", count: 1},
{node: "sure", count: 1},
{node: "taller", count: 1},
{node: "confid", count: 1},
{node: "respons", count: 1},
{node: "matur", count: 1},
{node: "shallow", count: 1},
{node: "signific", count: 1},
{node: "white", count: 1},
{node: "true", count: 1},
{node: "capabl", count: 1},
{node: "averag", count: 2},
{node: "meaning", count: 1},
{node: "fun", count: 1},
{node: "attract", count: 3},
{node: "marri", count: 1},
{node: "content", count: 1},
{node: "great", count: 1},
{node: "sweet", count: 1},
{node: "afraid", count: 1},
{node: "strong", count: 2},
{node: "comfort", count: 1},
{node: "shoulder", count: 1},
{node: "high", count: 1},
{node: "big", count: 1},
{node: "shorter", count: 1},
{node: "smart", count: 1}
]

var vis = new pv.Panel()
    .width(960)
    .height(720)
    .top(0)
    .left(0);

// Setup the layout
var leftmost = vis.add(pv.Panel)
	.width(4*column)
	.top(0)
	.left(0)
//	.lineWidth(1)
//	.strokeStyle("#888")

var midleft = vis.add(pv.Panel)
	.width(2*column)
	.top(0)
	.left(4*column)
//	.lineWidth(1)
//	.strokeStyle("#888")

var middle = vis.add(pv.Panel)
	.width(4*column)
	.top(0)
	.left(6*column)
//	.lineWidth(1)
//	.strokeStyle("#888")

var midright = vis.add(pv.Panel)
	.width(2*column)
	.top(0)
	.left(10*column)
//	.lineWidth(1)
//	.strokeStyle("#888")

var rightmost = vis.add(pv.Panel)
	.width(4*column)
	.top(0)
	.left(12*column)
//	.lineWidth(1)
//	.strokeStyle("#888")


// Add the words to the left panel. Sort them by prevalence, 
incoming.sort(function(a,b) {return a.count - b.count})
leftmost.add(pv.Label)
	.data(incoming)
	.right(0)
	.top(function(d) {return 720/2 + (-incoming.length/2 + this.index + 1)*wordHeight })
	.text(function(d) {return d.node})
	.textBaseline("middle")
	.textAlign("right")
	.font("1.4em Helvetica, Arial, sans-serif")

sum = 0;	
for (i = 0; i < incoming.length; i++) {
	sum = sum + incoming[i].count
	runSum[i] = sum
}
		var thisSum = sum + 0 // capture the value before it changes
midleft.add(pv.Panel)
	.data(incoming)
  .add(pv.Line)
  	.data(function(d) { 
		var ret = [
			{x: 0*column, y: 720/2 + (-incoming.length/2 + this.parent.index + 1)*wordHeight},
			{x: 0.5*column, y: 720/2 + (-incoming.length/2 + this.parent.index + 1)*wordHeight},
			{x: 1.5*column, y: 720/2 + (-Math.floor(thisSum/2) + runSum[this.parent.index])},
			{x: 2*column, y: 720/2 + (-Math.floor(thisSum/2) + runSum[this.parent.index])},
		]
		return ret})
	.strokeStyle("#888")
	.lineWidth(function(_, d) {return d.count})
	.interpolate("basis")
    .left(function(d) {return d.x})
    .top(function(d) {return d.y})


// Add the words to the left panel. Sort them by prevalence, 
outgoing.sort(function(a,b) {return a.count - b.count})
rightmost.add(pv.Label)
	.data(outgoing)
	.left(0)
	.top(function(d) {return 720/2 + (-outgoing.length/2 + this.index + 1)*wordHeight })
	.text(function(d) {return d.node})
	.textBaseline("middle")
	.textAlign("left")
	.font("1.4em Helvetica, Arial, sans-serif")
	
var outgoingRunSum = []
var i;
sum = 0;
for (i = 0; i < outgoing.length; i++) {
	sum = sum + outgoing[i].count
	outgoingRunSum[i] = sum
}
midright.add(pv.Panel)
	.data(outgoing)
  .add(pv.Line)
  	.data(function(d) { 
		var ret = [
			{x: 0*column, y: 720/2 + (-Math.floor(sum/2) + outgoingRunSum[this.parent.index])},
			{x: 0.5*column, y: 720/2 + (-Math.floor(sum/2) + outgoingRunSum[this.parent.index])},
			{x: 1.5*column, y: 720/2 + (-outgoing.length/2 + this.parent.index + 1)*wordHeight},
			{x: 2*column, y: 720/2 + (-outgoing.length/2 + this.parent.index + 1)*wordHeight},
		]
		return ret})
	.strokeStyle("#888")
	.lineWidth(function(_, d) {return d.count})
	.interpolate("basis")
    .left(function(d) {return d.x})
    .top(function(d) {return d.y})
	
middle.add(pv.Line)
	.data([	{x: 0, y: 720/2 + thisSum/2},
			{x: 4*column, y: 720/2 + sum/2},
			{x: 4*column, y: 720/2 - sum/2},
			{x: 0*column, y: 720/2 - thisSum/2}])
	.fillStyle("#888")
	.left(function(d) {return d.x})
    .top(function(d) {return d.y})
	.lineWidth(0)
	.strokeStyle("#000")


// Add the words at the center, left and right
middle.add(pv.Label)
	.data([word])
	.left(2*column)
	.top(720/2)
	.width(4*column)
	.textBaseline("middle")
	.textAlign("center")
	.font("5em Helvetica, Arial, sans-serif")

vis.render();

    </script>
  </div></div></body>
</html>